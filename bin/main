#!/usr/bin/env ruby
require_relative '../lib/game'

puts 'Welcome to Tic Tac Toe!'

loop do # rubocop:todo Metrics/BlockLength
  puts "Would you like to play a game of tic tac toe? Please enter '[y]es' or '[n]o'"
  play_game = gets.chomp[0].downcase
  while %w[y n].include?(play_game) == false
    puts "Please enter '[y]es' or '[n]o'"
    play_game = gets.chomp.downcase
  end
  if play_game[0] == 'y'
    puts 'We are going to start the game shortly after asking you a few more questions'
    game = Game.new
    game.players
    puts 'What is the name of first player'
    game.first_player.name = gets.chomp.capitalize
    puts 'What is the name of second player'
    game.second_player.name = gets.chomp.capitalize
    puts game.board.print_board
    puts "The players are #{game.first_player.name}(#{game.first_player.mark}) and #{game.second_player.name}" \
      "(#{game.second_player.mark})"
    puts 'Do you want to change the symbols of players. If yes, push [y]'
    chosen = gets.chomp.downcase
    game.change_symbol if chosen[0] == 'y'
    puts "The players are #{game.first_player.name}(#{game.first_player.mark}) and #{game.second_player.name}" \
      "(#{game.second_player.mark})"

    loop do
      game.check_player
      puts "It is #{game.current_user.keys[0]}'s turn"
      loop do
        puts game.board.print_board
        puts 'Choose the number to play'
        chosen = gets.chomp.to_i
        if !(1..9).include?(chosen)
          puts 'Please select another number between 1 and 9'
        elsif !game.board.board[chosen - 1].is_a? Integer
          puts 'Chosen number is used before'
        else
          game.board.update_board(chosen, game.current_user.values[0])
          break
        end
      end
      game.turn_increase
      game.check_win
      if game.winner and game.turn_counter > 4
        puts "There is a WINNER: #{game.current_user.keys[0]}"
        break
      end
      next unless game.turn_counter == 9

      puts 'Draw'
      break
    end
  elsif play_game[0] == 'n'
    puts 'Hope to see you again. Bye.'
    break
  end
end
